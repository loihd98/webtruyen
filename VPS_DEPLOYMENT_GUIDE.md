# üöÄ H∆∞·ªõng D·∫´n Deploy Web Truy·ªán L√™n VPS (Docker)

## üìã Th√¥ng Tin VPS
- **IP:** 180.93.138.93
- **Domain (n·∫øu c√≥):** yourdomain.com
- **OS:** Ubuntu/CentOS (gi·∫£ ƒë·ªãnh)
- **Deploy Method:** Docker + Docker Compose

## üîß B∆∞·ªõc 1: Chu·∫©n B·ªã VPS

### 1.1 K·∫øt n·ªëi SSH
```bash
ssh root@180.93.138.93
# ho·∫∑c
ssh username@180.93.138.93
```

### 1.2 C·∫≠p nh·∫≠t h·ªá th·ªëng
```bash
# Ubuntu/Debian
sudo apt update && sudo apt upgrade -y

# CentOS/RHEL
sudo yum update -y
```

### 1.3 C√†i ƒë·∫∑t Docker & Docker Compose
```bash
# Ubuntu/Debian - C√†i ƒë·∫∑t Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER

# C√†i ƒë·∫∑t Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.21.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# Kh·ªüi ƒë·ªông Docker service
sudo systemctl start docker
sudo systemctl enable docker

# Ki·ªÉm tra c√†i ƒë·∫∑t
docker --version
docker-compose --version
```

### 1.4 C√†i ƒë·∫∑t Git v√† Nginx
```bash
# Ubuntu/Debian
sudo apt install -y git nginx

# CentOS/RHEL
sudo yum install -y git nginx
```

### 1.5 T·∫°o th∆∞ m·ª•c project
```bash
sudo mkdir -p /var/www/web-truyen
sudo chown $USER:$USER /var/www/web-truyen
cd /var/www/web-truyen
```

## üì¶ B∆∞·ªõc 2: Upload Source Code

### 2.1 Clone repository (ph∆∞∆°ng ph√°p Git - khuy·∫øn ngh·ªã)
```bash
cd /var/www/web-truyen
git clone https://github.com/loihd98/webtruyen.git .

# Ho·∫∑c clone t·ª´ branch c·ª• th·ªÉ
git clone -b main https://github.com/loihd98/webtruyen.git .
```

### 2.2 T·∫°o file environment variables
```bash
# T·∫°o .env file cho production
cp .env.example .env
nano .env
```

**N·ªôi dung file .env:**
```env
# Database
DATABASE_URL="postgresql://web_truyen_user:your-strong-password@db:5432/web_truyen_prod"

# JWT
JWT_SECRET="your-jwt-secret-key-here-make-it-very-long-and-secure"

# Server
NODE_ENV=production
PORT=3001

# Frontend URL (cho CORS)
FRONTEND_URL=http://180.93.138.93:3000

# Email (n·∫øu c√≥)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password

# Upload paths
UPLOAD_PATH=/app/uploads
```

## ÔøΩ B∆∞·ªõc 3: C·∫•u H√¨nh Docker Production

### 3.1 C·∫≠p nh·∫≠t docker-compose.prod.yml
```bash
nano docker-compose.prod.yml
```

**N·ªôi dung file docker-compose.prod.yml:**
```yaml
version: '3.8'

services:
  # PostgreSQL Database
  db:
    image: postgres:15
    container_name: web-truyen-db
    environment:
      POSTGRES_DB: web_truyen_prod
      POSTGRES_USER: web_truyen_user
      POSTGRES_PASSWORD: your-strong-password-here
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    restart: unless-stopped
    networks:
      - web-truyen-network

  # Backend API
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: web-truyen-backend
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://web_truyen_user:your-strong-password-here@db:5432/web_truyen_prod
      - JWT_SECRET=your-jwt-secret-key-here
      - PORT=3001
    ports:
      - "3001:3001"
    volumes:
      - ./uploads:/app/uploads
      - ./logs:/app/logs
    depends_on:
      - db
    restart: unless-stopped
    networks:
      - web-truyen-network

  # Frontend Next.js
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        - NEXT_PUBLIC_API_URL=http://180.93.138.93:3001
    container_name: web-truyen-frontend
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_API_URL=http://180.93.138.93:3001
    depends_on:
      - backend
    restart: unless-stopped
    networks:
      - web-truyen-network

  # Nginx Reverse Proxy
  nginx:
    build:
      context: ./nginx
      dockerfile: Dockerfile
    container_name: web-truyen-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
      - ./logs/nginx:/var/log/nginx
    depends_on:
      - frontend
      - backend
    restart: unless-stopped
    networks:
      - web-truyen-network

volumes:
  postgres_data:

networks:
  web-truyen-network:
    driver: bridge
```

## üöÄ B∆∞·ªõc 4: Deploy Application

### 4.1 Build v√† kh·ªüi ƒë·ªông containers
```bash
# Build v√† kh·ªüi ƒë·ªông t·∫•t c·∫£ services
docker-compose -f docker-compose.prod.yml up -d --build

# Ki·ªÉm tra tr·∫°ng th√°i containers
docker-compose -f docker-compose.prod.yml ps

# Xem logs
docker-compose -f docker-compose.prod.yml logs -f
```

### 4.2 Ch·∫°y database migrations
```bash
# Ch·∫°y Prisma migrations
docker-compose -f docker-compose.prod.yml exec backend npx prisma migrate deploy

# Generate Prisma client
docker-compose -f docker-compose.prod.yml exec backend npx prisma generate

# Seed database (t√πy ch·ªçn)
docker-compose -f docker-compose.prod.yml exec backend npm run seed
```
## üåê B∆∞·ªõc 5: C·∫•u H√¨nh Nginx

### 5.1 T·∫°o Nginx Dockerfile
```bash
mkdir -p nginx
nano nginx/Dockerfile
```

**N·ªôi dung nginx/Dockerfile:**
```dockerfile
FROM nginx:alpine

# Copy nginx configuration
COPY nginx.conf /etc/nginx/nginx.conf

# Create log directory
RUN mkdir -p /var/log/nginx

# Expose ports
EXPOSE 80 443

CMD ["nginx", "-g", "daemon off;"]
```

### 5.2 C·∫•u h√¨nh Nginx reverse proxy
```bash
nano nginx/nginx.conf
```

**N·ªôi dung nginx/nginx.conf:**
```nginx
events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;
    
    # Logging
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';
    
    access_log /var/log/nginx/access.log main;
    error_log /var/log/nginx/error.log;
    
    # Gzip compression
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
    
    # Rate limiting
    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
    limit_req_zone $binary_remote_addr zone=web:10m rate=20r/s;
    
    # Backend upstream
    upstream backend {
        server backend:3001;
    }
    
    # Frontend upstream  
    upstream frontend {
        server frontend:3000;
    }
    
    server {
        listen 80;
        server_name 180.93.138.93;
        
        # Security headers
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-XSS-Protection "1; mode=block" always;
        add_header Referrer-Policy "no-referrer-when-downgrade" always;
        
        # API routes
        location /api/ {
            limit_req zone=api burst=20 nodelay;
            
            proxy_pass http://backend;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_cache_bypass $http_upgrade;
            
            # Timeout settings
            proxy_connect_timeout 60s;
            proxy_send_timeout 60s;
            proxy_read_timeout 60s;
        }
        
        # Static file uploads
        location /uploads/ {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # Cache static files
            expires 30d;
            add_header Cache-Control "public, immutable";
        }
        
        # Frontend routes
        location / {
            limit_req zone=web burst=50 nodelay;
            
            proxy_pass http://frontend;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_cache_bypass $http_upgrade;
        }
        
        # Health check
        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }
    }
}
```

## ÔøΩ B∆∞·ªõc 6: SSL/HTTPS (T√πy ch·ªçn)

### 6.1 C√†i ƒë·∫∑t Certbot trong container ri√™ng
```bash
# T·∫°o docker-compose.ssl.yml
nano docker-compose.ssl.yml
```

```yaml
version: '3.8'

services:
  certbot:
    image: certbot/certbot
    container_name: certbot
    volumes:
      - ./ssl:/etc/letsencrypt
      - ./ssl-challenge:/var/www/certbot
    command: certonly --webroot --webroot-path=/var/www/certbot --email your-email@example.com --agree-tos --no-eff-email -d yourdomain.com
```

### 6.2 C·∫≠p nh·∫≠t Nginx cho HTTPS
```nginx
# Th√™m v√†o nginx.conf
server {
    listen 443 ssl http2;
    server_name yourdomain.com;
    
    ssl_certificate /etc/nginx/ssl/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/nginx/ssl/live/yourdomain.com/privkey.pem;
    
    # SSL configuration
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    
    # Redirect HTTP to HTTPS
}

server {
    listen 80;
    server_name yourdomain.com;
    return 301 https://$server_name$request_uri;
}
```

## üîß B∆∞·ªõc 7: Scripts Qu·∫£n L√Ω

### 7.1 T·∫°o script deploy
```bash
nano deploy.sh
chmod +x deploy.sh
```

**N·ªôi dung deploy.sh:**
```bash
#!/bin/bash

echo "üöÄ Starting deployment..."

# Pull latest code
git pull origin main

# Stop containers
echo "üì¶ Stopping containers..."
docker-compose -f docker-compose.prod.yml down

# Rebuild and start
echo "üî® Building and starting containers..."
docker-compose -f docker-compose.prod.yml up -d --build

# Run migrations
echo "üóÑÔ∏è Running database migrations..."
sleep 10
docker-compose -f docker-compose.prod.yml exec -T backend npx prisma migrate deploy

# Check health
echo "üè• Checking application health..."
sleep 15
curl -f http://localhost:3000/health || echo "‚ùå Health check failed"

echo "‚úÖ Deployment completed!"
```

### 7.2 T·∫°o script backup database
```bash
nano backup.sh
chmod +x backup.sh
```

**N·ªôi dung backup.sh:**
```bash
#!/bin/bash

BACKUP_DIR="/var/backups/webtruyen"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR

echo "üì¶ Creating database backup..."
docker-compose -f docker-compose.prod.yml exec -T db pg_dump -U web_truyen_user web_truyen_prod > $BACKUP_DIR/db_backup_$DATE.sql

echo "üìÅ Creating uploads backup..."
tar -czf $BACKUP_DIR/uploads_backup_$DATE.tar.gz ./uploads

# Keep only last 7 days of backups
find $BACKUP_DIR -name "*.sql" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete

echo "‚úÖ Backup completed: $BACKUP_DIR"
```

## üìä B∆∞·ªõc 8: Monitoring v√† Logs

### 8.1 Theo d√µi logs
```bash
# Xem logs t·∫•t c·∫£ services
docker-compose -f docker-compose.prod.yml logs -f

# Xem logs service c·ª• th·ªÉ
docker-compose -f docker-compose.prod.yml logs -f backend
docker-compose -f docker-compose.prod.yml logs -f frontend
docker-compose -f docker-compose.prod.yml logs -f nginx

# Xem logs v·ªõi s·ªë d√≤ng gi·ªõi h·∫°n
docker-compose -f docker-compose.prod.yml logs --tail=100 -f
```

### 8.2 Ki·ªÉm tra tr·∫°ng th√°i containers
```bash
# Ki·ªÉm tra containers ƒëang ch·∫°y
docker ps

# Ki·ªÉm tra resource usage
docker stats

# Ki·ªÉm tra disk usage
docker system df
```

### 8.3 T·∫°o script monitoring
```bash
nano monitor.sh
chmod +x monitor.sh
```

**N·ªôi dung monitor.sh:**
```bash
#!/bin/bash

echo "üîç Web Truyen Monitoring Report"
echo "================================"
echo "üìÖ Date: $(date)"
echo ""

echo "üê≥ Container Status:"
docker-compose -f docker-compose.prod.yml ps

echo ""
echo "üíæ Disk Usage:"
df -h /var/www/webtruyen

echo ""
echo "üß† Memory Usage:"
free -h

echo ""
echo "üåê Application Health:"
curl -s http://localhost:3000/health && echo " - Frontend: ‚úÖ OK" || echo " - Frontend: ‚ùå FAIL"
curl -s http://localhost:3001/api/health && echo " - Backend: ‚úÖ OK" || echo " - Backend: ‚ùå FAIL"

echo ""
echo "üìä Database Status:"
docker-compose -f docker-compose.prod.yml exec -T db pg_isready -U web_truyen_user -d web_truyen_prod
```

## üö® B∆∞·ªõc 9: Troubleshooting

### 9.1 C√°c l·ªánh debug ph·ªï bi·∫øn
```bash
# Ki·ªÉm tra logs chi ti·∫øt
docker-compose -f docker-compose.prod.yml logs backend
docker-compose -f docker-compose.prod.yml logs frontend

# V√†o container ƒë·ªÉ debug
docker-compose -f docker-compose.prod.yml exec backend bash
docker-compose -f docker-compose.prod.yml exec frontend sh

# Ki·ªÉm tra network
docker network ls
docker network inspect web-truyen_web-truyen-network

# Restart services
docker-compose -f docker-compose.prod.yml restart backend
docker-compose -f docker-compose.prod.yml restart frontend
```

### 9.2 C√°c v·∫•n ƒë·ªÅ th∆∞·ªùng g·∫∑p

**Database connection failed:**
```bash
# Ki·ªÉm tra database container
docker-compose -f docker-compose.prod.yml logs db

# Ki·ªÉm tra database connection
docker-compose -f docker-compose.prod.yml exec backend npx prisma db push --preview-feature
```

**Frontend kh√¥ng build ƒë∆∞·ª£c:**
```bash
# Clear cache v√† rebuild
docker-compose -f docker-compose.prod.yml down
docker system prune -a
docker-compose -f docker-compose.prod.yml up -d --build
```

**Port ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng:**
```bash
# Ki·ªÉm tra port ƒëang s·ª≠ d·ª•ng
netstat -tulpn | grep :3000
netstat -tulpn | grep :3001

# Kill process s·ª≠ d·ª•ng port
sudo kill -9 $(sudo lsof -t -i:3000)
```

## üîÑ B∆∞·ªõc 10: C·∫≠p Nh·∫≠t Application

### 10.1 Script c·∫≠p nh·∫≠t t·ª± ƒë·ªông
```bash
nano update.sh
chmod +x update.sh
```

**N·ªôi dung update.sh:**
```bash
#!/bin/bash

echo "üîÑ Updating Web Truyen..."

# Backup tr∆∞·ªõc khi update
./backup.sh

# Pull latest code
git pull origin main

# Rebuild v√† restart
docker-compose -f docker-compose.prod.yml up -d --build

# Run migrations n·∫øu c√≥
docker-compose -f docker-compose.prod.yml exec -T backend npx prisma migrate deploy

echo "‚úÖ Update completed!"
```

### 10.2 Crontab t·ª± ƒë·ªông backup
```bash
# M·ªü crontab
crontab -e

# Th√™m c√°c d√≤ng sau ƒë·ªÉ backup h√†ng ng√†y l√∫c 2:00 AM
0 2 * * * /var/www/webtruyen/backup.sh

# Ch·∫°y monitoring m·ªói 30 ph√∫t
*/30 * * * * /var/www/webtruyen/monitor.sh >> /var/log/webtruyen-monitor.log
```

## üéØ B∆∞·ªõc 11: Ho√†n Th√†nh

### 11.1 Ki·ªÉm tra final
```bash
# Ki·ªÉm tra t·∫•t c·∫£ containers ƒëang ch·∫°y
docker-compose -f docker-compose.prod.yml ps

# Test application
curl http://180.93.138.93:3000
curl http://180.93.138.93:3001/api/health
```

### 11.2 URLs ƒë·ªÉ truy c·∫≠p
- **Frontend:** http://180.93.138.93:3000
- **Backend API:** http://180.93.138.93:3001/api
- **Admin Panel:** http://180.93.138.93:3000/admin

### 11.3 Th√¥ng tin ƒëƒÉng nh·∫≠p admin (sau khi seed)
- **Email:** admin@webtruyen.com
- **Password:** admin123456

---

## üìù Ghi Ch√∫ Quan Tr·ªçng

1. **Security:** Thay ƒë·ªïi t·∫•t c·∫£ m·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh
2. **SSL:** C√†i ƒë·∫∑t SSL certificate cho production
3. **Backup:** Thi·∫øt l·∫≠p backup t·ª± ƒë·ªông
4. **Monitoring:** Theo d√µi logs v√† performance th∆∞·ªùng xuy√™n
5. **Updates:** C·∫≠p nh·∫≠t dependencies v√† security patches

**Ch√∫c m·ª´ng! üéâ Web Truy·ªán c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c deploy th√†nh c√¥ng v·ªõi Docker!**

# NextAuth
NEXTAUTH_URL=http://180.93.138.93:3000
NEXTAUTH_SECRET=your-production-nextauth-secret-minimum-64-characters

# Email
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
SMTP_FROM=noreply@yourdomain.com

# File upload
MAX_FILE_SIZE=10485760
UPLOAD_PATH=/var/www/webtruyen/uploads

# Environment
NODE_ENV=production
PORT=5000
```

## üèóÔ∏è B∆∞·ªõc 5: Build & Deploy Backend

### 5.1 C√†i ƒë·∫∑t dependencies
```bash
cd /var/www/webtruyen/backend
npm install --production
```

### 5.2 Ch·∫°y Prisma migrations
```bash
npx prisma generate
npx prisma db push
# ho·∫∑c n·∫øu c√≥ migrations
npx prisma migrate deploy
```

### 5.3 Seed database (t√πy ch·ªçn)
```bash
node src/scripts/seed.js
```

### 5.4 T·∫°o th∆∞ m·ª•c uploads
```bash
mkdir -p /var/www/webtruyen/uploads/{images,audio}
chmod 755 /var/www/webtruyen/uploads
```

### 5.5 Kh·ªüi ƒë·ªông backend v·ªõi PM2
```bash
cd /var/www/webtruyen/backend

# T·∫°o ecosystem file
cat > ecosystem.config.js << EOF
module.exports = {
  apps: [{
    name: 'webtruyen-backend',
    script: 'src/index.js',
    cwd: '/var/www/webtruyen/backend',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 5000
    }
  }]
};
EOF

# Kh·ªüi ƒë·ªông
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

## üé® B∆∞·ªõc 6: Build & Deploy Frontend

### 6.1 C√†i ƒë·∫∑t dependencies
```bash
cd /var/www/webtruyen/frontend
npm install
```

### 6.2 Build production
```bash
npm run build
```

### 6.3 Kh·ªüi ƒë·ªông frontend v·ªõi PM2
```bash
cat > ecosystem.config.js << EOF
module.exports = {
  apps: [{
    name: 'webtruyen-frontend',
    script: 'npm',
    args: 'start',
    cwd: '/var/www/webtruyen/frontend',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    }
  }]
};
EOF

pm2 start ecosystem.config.js
```

## üåê B∆∞·ªõc 7: C·∫•u H√¨nh Nginx

### 7.1 T·∫°o Nginx config
```bash
sudo nano /etc/nginx/sites-available/webtruyen
```

### 7.2 N·ªôi dung config
```nginx
server {
    listen 80;
    server_name 180.93.138.93 yourdomain.com;

    # Frontend
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # Backend API
    location /api {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # Static files (uploads)
    location /uploads {
        alias /var/www/webtruyen/uploads;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;

    # Gzip compression
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied expired no-cache no-store private must-revalidate auth;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/javascript;
}
```

### 7.3 K√≠ch ho·∫°t site
```bash
sudo ln -s /etc/nginx/sites-available/webtruyen /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
sudo systemctl enable nginx
```

## üîí B∆∞·ªõc 8: C√†i ƒê·∫∑t SSL (T√πy ch·ªçn - n·∫øu c√≥ domain)

```bash
# C√†i ƒë·∫∑t Certbot
sudo apt install certbot python3-certbot-nginx

# T·∫°o SSL certificate
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# Auto-renewal
sudo systemctl enable certbot.timer
```

## üî• B∆∞·ªõc 9: C·∫•u H√¨nh Firewall

```bash
# Ubuntu UFW
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw enable

# CentOS firewalld
sudo firewall-cmd --permanent --add-service=ssh
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

## üìä B∆∞·ªõc 10: Monitoring & Logs

### 10.1 PM2 monitoring
```bash
# Xem status
pm2 status

# Xem logs
pm2 logs

# Restart apps
pm2 restart all

# Monitor
pm2 monit
```

### 10.2 Nginx logs
```bash
# Access logs
sudo tail -f /var/log/nginx/access.log

# Error logs
sudo tail -f /var/log/nginx/error.log
```

### 10.3 System monitoring
```bash
# C√†i ƒë·∫∑t htop
sudo apt install htop

# Monitor resources
htop
```

## üöÄ B∆∞·ªõc 11: Automated Deployment Script

### 11.1 T·∫°o script deploy
```bash
nano /var/www/webtruyen/deploy.sh
```

### 11.2 N·ªôi dung script
```bash
#!/bin/bash

echo "üöÄ Starting deployment..."

# Navigate to project directory
cd /var/www/webtruyen

# Pull latest changes
echo "üì• Pulling latest changes..."
git pull origin master

# Backend deployment
echo "üîß Deploying backend..."
cd backend
npm install --production
npx prisma generate
npx prisma db push
pm2 restart webtruyen-backend

# Frontend deployment
echo "üé® Deploying frontend..."
cd ../frontend
npm install
npm run build
pm2 restart webtruyen-frontend

echo "‚úÖ Deployment completed!"

# Show status
pm2 status
```

### 11.3 L√†m cho script executable
```bash
chmod +x /var/www/webtruyen/deploy.sh
```

## üîß Troubleshooting

### Ki·ªÉm tra services
```bash
# PM2 processes
pm2 status

# Nginx
sudo systemctl status nginx

# PostgreSQL
sudo systemctl status postgresql

# Check ports
sudo netstat -tulpn | grep -E ':(3000|5000|80|5432)'
```

### Restart to√†n b·ªô
```bash
pm2 restart all
sudo systemctl restart nginx
sudo systemctl restart postgresql
```

### Logs debugging
```bash
# PM2 logs
pm2 logs --lines 50

# Nginx error logs
sudo tail -50 /var/log/nginx/error.log

# System logs
journalctl -u nginx -f
```

## üåç Truy C·∫≠p ·ª®ng D·ª•ng

Sau khi ho√†n th√†nh t·∫•t c·∫£ c√°c b∆∞·ªõc:

- **Frontend:** http://180.93.138.93 (ho·∫∑c yourdomain.com)
- **API:** http://180.93.138.93/api
- **Admin:** http://180.93.138.93/admin

## üë§ Th√¥ng Tin ƒêƒÉng Nh·∫≠p

T·ª´ script seed:
- **Admin:** admin@webtruyen.com / admin123456
- **User:** user@example.com / user123456

## üîÑ C·∫≠p Nh·∫≠t Code

ƒê·ªÉ c·∫≠p nh·∫≠t code sau n√†y:
```bash
cd /var/www/webtruyen
./deploy.sh
```

---

**üìå L∆∞u √Ω:** Thay th·∫ø `yourdomain.com` b·∫±ng domain th·ª±c t·∫ø c·ªßa b·∫°n v√† c·∫≠p nh·∫≠t c√°c passwords/secrets cho ph√π h·ª£p v·ªõi production environment.